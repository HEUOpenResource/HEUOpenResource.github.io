name: ğŸš€ éƒ¨ç½²

on:
  push:
    branches:
      - main
    paths:
      - update.py
      - contributors.json
      - docs/.vuepress/*.ts
  workflow_dispatch:
  repository_dispatch:
    types: [heu-icicles-main-updated]
  

jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # è®¾ç½® Node.js
      - name: ğŸŸ¢ è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: 22

      # è®¾ç½® Pythonï¼ˆç”¨äºè¿è¡Œ update.pyï¼‰
      - name: ğŸ å®‰è£… Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'

      # å¦‚æœ update.py ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼Œå–æ¶ˆæ³¨é‡Šæ­¤æ­¥
      - name: ğŸ“¦ å®‰è£… Python ä¾èµ–
        run: pip install -r requirements.txt

      # æ‰§è¡Œé¡¹ç›®æ ¹ç›®å½•çš„ update.py
      - name: ğŸ› ï¸ æ›´æ–°èµ„æ–™è¡¨ä»¥åŠæ­£å¸¸è´¡çŒ®è€…
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: python update.py

      # æ‰§è¡Œé¡¹ç›®æ ¹ç›®å½•çš„ addContributors.pyï¼ˆç»†åˆ†åˆ°æ¯ä¸€ä¸ªç§‘ç›®ï¼‰ ã€allContributors.pyï¼ˆâ€œä»‹ç»â€é¡µé¢ä¸­æ˜¾ç¤ºï¼‰
      - name: ğŸ‘¥ æ·»åŠ éGithubè´¡çŒ®è€…
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python addContributors.py
          python allContributors.py

      # å®‰è£… Node ä¾èµ–
      - name: ğŸ“¦ å®‰è£… Node ä¾èµ–
        run: npm i

      # æ„å»º VuePress
      - name: ğŸ—ï¸ æ„å»º VuePress ç«™ç‚¹
        env:
          NODE_OPTIONS: --max_old_space_size=8192
        run: npm run docs:build

      # éƒ¨ç½²åˆ° GitHub Pages
      - name: ğŸŒ éƒ¨ç½²åˆ° GitHub Pages
        uses: crazy-max/ghaction-github-pages@v4
        with:
          target_branch: gh-pages
          build_dir: docs/.vuepress/dist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
